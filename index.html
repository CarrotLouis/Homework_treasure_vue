<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¯»å®æ¸¸æˆ - Vue 3 ç‰ˆæœ¬</title>
  <link rel="stylesheet" href="vue-app/styles/main.css">
</head>
<body>
  <div id="app">
    <div style="padding: 40px; text-align: center; color: white;">
      <h2>ğŸ”„ åŠ è½½ä¸­...</h2>
      <p>è¯·ç¨å€™</p>
    </div>
  </div>
  
  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.prod.js"></script>
  <!-- Vue Router CDN -->
  <script src="https://unpkg.com/vue-router@4.2.4/dist/vue-router.global.prod.js"></script>
  <!-- Vue Demi (Pinia ä¾èµ–) -->
  <script src="https://unpkg.com/vue-demi@0.14.6/lib/index.iife.js"></script>
  <!-- Pinia CDN -->
  <script src="https://unpkg.com/pinia@2.1.7/dist/pinia.iife.prod.js"></script>
  
  <!-- åº”ç”¨å…¥å£ -->
  <script>
    // æ£€æŸ¥æ‰€æœ‰åº“æ˜¯å¦åŠ è½½æˆåŠŸ
    window.addEventListener('load', function() {
      if (typeof Vue === 'undefined') {
        document.getElementById('app').innerHTML = `
          <div style="padding: 40px; text-align: center; color: white;">
            <h2>âš ï¸ Vue åŠ è½½å¤±è´¥</h2>
            <p>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>
            <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
              åˆ·æ–°é¡µé¢
            </button>
          </div>
        `;
        return;
      }
      
      if (typeof VueRouter === 'undefined') {
        document.getElementById('app').innerHTML = `
          <div style="padding: 40px; text-align: center; color: white;">
            <h2>âš ï¸ Vue Router åŠ è½½å¤±è´¥</h2>
            <p>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>
            <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
              åˆ·æ–°é¡µé¢
            </button>
          </div>
        `;
        return;
      }
      
      if (typeof Pinia === 'undefined') {
        document.getElementById('app').innerHTML = `
          <div style="padding: 40px; text-align: center; color: white;">
            <h2>âš ï¸ Pinia åŠ è½½å¤±è´¥</h2>
            <p>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>
            <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
              åˆ·æ–°é¡µé¢
            </button>
          </div>
        `;
        return;
      }
      
      // æ‰€æœ‰åº“åŠ è½½æˆåŠŸï¼ŒåŠ è½½åº”ç”¨è„šæœ¬
      loadScript('./vue-app/stores/gameStore.js')
        .then(() => loadScript('./vue-app/App.js'))
        .then(() => loadScript('./vue-app/views/GameView.js'))
        .then(() => loadScript('./vue-app/views/UserManagement.js'))
        .then(() => loadScript('./vue-app/views/Leaderboard.js'))
        .then(() => {
          // ç­‰å¾…æ‰€æœ‰ç»„ä»¶åŠ è½½å®Œæˆ
          return new Promise(resolve => setTimeout(resolve, 200));
        })
        .then(() => {
          const { createApp } = Vue;
          const { createRouter, createWebHashHistory } = VueRouter;
          const { createPinia } = Pinia;
          
          // åˆ›å»ºè·¯ç”±
          const routes = [
            { path: '/', name: 'Game', component: window.GameView },
            { path: '/users', name: 'Users', component: window.UserManagement },
            { path: '/leaderboard', name: 'Leaderboard', component: window.Leaderboard }
          ];
          
          const router = createRouter({
            history: createWebHashHistory(),
            routes
          });
          
          // åˆ›å»ºåº”ç”¨
          const app = createApp(window.App);
          app.use(createPinia());
          app.use(router);
          app.mount('#app');
        })
        .catch(err => {
          console.error('åº”ç”¨åŠ è½½å¤±è´¥:', err);
          document.getElementById('app').innerHTML = `
            <div style="padding: 40px; text-align: center; color: white;">
              <h2>âš ï¸ åº”ç”¨åŠ è½½å¤±è´¥</h2>
              <p>${err.message}</p>
              <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">
                åˆ·æ–°é¡µé¢
              </button>
            </div>
          `;
        });
    });
    
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = () => reject(new Error(`æ— æ³•åŠ è½½ ${src}`));
        document.head.appendChild(script);
      });
    }
  </script>
</body>
</html>
